<div class="page-container">
  <header class="page-header">
    <div class="header-content">
      <h1>
        <span class="material-icons">assignment</span>
        Mes Exercices
      </h1>
      <p class="subtitle">Créez et gérez vos exercices pratiques</p>
    </div>
    <button class="btn btn-primary" (click)="openCreateModal()">
      <span class="material-icons">add</span>
      Nouvel Exercice
    </button>
  </header>

  <!-- Filters -->
  <div class="filters-section" *ngIf="!isLoading && exercises.length > 0">
    <div class="search-box">
      <span class="material-icons">search</span>
      <input 
        type="text" 
        placeholder="Rechercher un exercice..."
        [(ngModel)]="searchTerm"
        (input)="filterExercises()">
    </div>
    <div class="filter-controls">
      <select [(ngModel)]="selectedCourse" (change)="filterExercises()">
        <option value="all">Tous les cours</option>
        <option *ngFor="let course of courses" [value]="course.id">{{ course.title }}</option>
      </select>
      <select [(ngModel)]="selectedDifficulty" (change)="filterExercises()">
        <option value="all">Toutes les difficultés</option>
        <option value="Facile">Facile</option>
        <option value="Moyen">Moyen</option>
        <option value="Difficile">Difficile</option>
      </select>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading" class="loading-state">
    <div class="spinner"></div>
    <p>Chargement des exercices...</p>
  </div>

  <!-- Exercises Grid -->
  <div *ngIf="!isLoading && filteredExercises.length > 0" class="exercises-grid">
    <div *ngFor="let exercise of filteredExercises" class="exercise-card">
      <div class="exercise-header">
        <h3>{{ exercise.title }}</h3>
        <span class="difficulty-badge" [style.background]="getDifficultyColor(exercise.difficulty || 'Moyen') + '20'" [style.color]="getDifficultyColor(exercise.difficulty || 'Moyen')">
          {{ exercise.difficulty || 'Moyen' }}
        </span>
      </div>
      <p>{{ exercise.description || 'Aucune description' }}</p>
      <div class="exercise-stats">
        <span>
          <span class="material-icons">schedule</span>
          {{ exercise.estimatedTime || 30 }} min
        </span>
        <span>
          <span class="material-icons">check_circle</span>
          {{ exercise.submissions?.length || 0 }} soumissions
        </span>
      </div>
      <div class="exercise-actions">
        <button class="btn btn-secondary">
          <span class="material-icons">edit</span>
          Modifier
        </button>
        <button class="btn btn-danger" (click)="deleteExercise(exercise.id)">
          <span class="material-icons">delete</span>
          Supprimer
        </button>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoading && filteredExercises.length === 0" class="empty-state">
    <span class="material-icons">assignment</span>
    <h3 *ngIf="exercises.length === 0">Aucun exercice</h3>
    <h3 *ngIf="exercises.length > 0">Aucun exercice trouvé</h3>
    <p *ngIf="exercises.length === 0">Créez votre premier exercice</p>
    <p *ngIf="exercises.length > 0">Modifiez vos filtres pour voir plus de résultats</p>
    <button *ngIf="exercises.length === 0" class="btn btn-primary" (click)="openCreateModal()">
      <span class="material-icons">add</span>
      Créer un Exercice
    </button>
  </div>
</div>

<!-- Modal de Création d'Exercice -->
<div *ngIf="showCreateModal" class="modal-overlay" (click)="closeCreateModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Créer un Nouvel Exercice</h2>
      <button class="btn-close" (click)="closeCreateModal()">
        <span class="material-icons">close</span>
      </button>
    </div>

    <form (ngSubmit)="createExercise()" class="modal-body">
      <div class="form-group">
        <label>Titre *</label>
        <input 
          type="text" 
          [(ngModel)]="newExercise.title" 
          name="title"
          placeholder="Ex: Créer une fonction JavaScript"
          required>
      </div>

      <div class="form-group">
        <label>Description</label>
        <textarea 
          [(ngModel)]="newExercise.description" 
          name="description"
          rows="3"
          placeholder="Décrivez l'exercice..."></textarea>
      </div>

      <div class="form-group">
        <label>Instructions</label>
        <textarea 
          [(ngModel)]="newExercise.instructions" 
          name="instructions"
          rows="4"
          placeholder="Instructions détaillées pour l'exercice..."></textarea>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Cours *</label>
          <select [(ngModel)]="newExercise.courseId" name="courseId" required>
            <option value="">Sélectionner un cours</option>
            <option *ngFor="let course of courses" [value]="course.id">{{ course.title }}</option>
          </select>
        </div>

        <div class="form-group">
          <label>Difficulté</label>
          <select [(ngModel)]="newExercise.difficulty" name="difficulty">
            <option value="Facile">Facile</option>
            <option value="Moyen">Moyen</option>
            <option value="Difficile">Difficile</option>
          </select>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Temps estimé (minutes)</label>
          <input 
            type="number" 
            [(ngModel)]="newExercise.estimatedTime" 
            name="estimatedTime"
            min="5"
            step="5">
        </div>

        <div class="form-group">
          <label>Type</label>
          <select [(ngModel)]="newExercise.type" name="type">
            <option value="PRATIQUE">Pratique</option>
            <option value="SIMULATION">Simulation</option>
            <option value="PROJET">Projet</option>
            <option value="CODE">Code</option>
          </select>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeCreateModal()">
          Annuler
        </button>
        <button type="submit" class="btn btn-primary" [disabled]="isCreating || !newExercise.title.trim() || !newExercise.courseId">
          <span *ngIf="isCreating" class="spinner-small"></span>
          <span *ngIf="!isCreating">Créer l'Exercice</span>
          <span *ngIf="isCreating">Création...</span>
        </button>
      </div>
    </form>
  </div>
</div>

