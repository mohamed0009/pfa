<div class="page-container">
  <header class="page-header">
    <div class="header-content">
      <h1>Mes Formations</h1>
      <p class="subtitle">Gérez vos formations et suivez leur performance</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-secondary" (click)="openTemplateModal()">
        <span class="material-icons">auto_awesome</span>
        Créer depuis Template
      </button>
      <button class="btn btn-primary" (click)="openCreateModal()">
        <span class="material-icons">add</span>
        Nouvelle Formation
      </button>
    </div>
  </header>

  <!-- Filters -->
  <div class="filters-section" *ngIf="!isLoading && formations.length > 0">
    <div class="search-box">
      <span class="material-icons">search</span>
      <input 
        type="text" 
        placeholder="Rechercher une formation..."
        [(ngModel)]="searchTerm"
        (input)="filterFormations()">
    </div>
    <div class="filter-controls">
      <select [(ngModel)]="selectedStatus" (change)="filterFormations()">
        <option value="all">Tous les statuts</option>
        <option value="draft">Brouillon</option>
        <option value="pending">En attente</option>
        <option value="approved">Approuvé</option>
        <option value="published">Publié</option>
      </select>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading" class="loading-state">
    <div class="spinner"></div>
    <p>Chargement des formations...</p>
  </div>

  <!-- Formations List -->
  <div *ngIf="!isLoading && filteredFormations.length > 0" class="formations-grid">
    <div *ngFor="let formation of filteredFormations" class="formation-card" [routerLink]="['/trainer/content/formations', formation.id]">
      <div class="formation-header">
        <div class="formation-thumbnail" [style.background-image]="'url(' + (formation.thumbnail || 'https://via.placeholder.com/400x200') + ')'">
          <div class="formation-overlay">
            <div class="formation-actions">
              <button class="btn-icon" (click)="openEditModal(formation); $event.stopPropagation()" title="Modifier">
                <span class="material-icons">edit</span>
              </button>
              <button class="btn-icon btn-danger" (click)="deleteFormation(formation, $event)" title="Supprimer">
                <span class="material-icons">delete</span>
              </button>
            </div>
          </div>
        </div>
        <div class="formation-content">
          <h3>{{ formation.title }}</h3>
          <p>{{ formation.description || 'Aucune description' }}</p>
          <div class="formation-meta">
            <span class="meta-item">
              <span class="material-icons">schedule</span>
              {{ formation.duration || 0 }}h
            </span>
            <span class="meta-item">
              <span class="material-icons">school</span>
              {{ formation.level || 'N/A' }}
            </span>
            <span class="meta-item status-badge" [style.background]="getStatusColor(formation.status)">
              {{ getStatusBadge(formation.status) }}
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoading && filteredFormations.length === 0" class="empty-state">
    <span class="material-icons">school</span>
    <h3 *ngIf="formations.length === 0">Aucune formation</h3>
    <h3 *ngIf="formations.length > 0">Aucun résultat</h3>
    <p *ngIf="formations.length === 0">Créez votre première formation pour commencer</p>
    <p *ngIf="formations.length > 0">Aucune formation ne correspond à votre recherche</p>
    <button *ngIf="formations.length === 0" class="btn btn-primary" (click)="openCreateModal()">
      <span class="material-icons">add</span>
      Créer une Formation
    </button>
  </div>
</div>

<!-- Modal de Création de Formation -->
<div *ngIf="showCreateModal" class="modal-overlay" (click)="closeCreateModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Créer une Nouvelle Formation</h2>
      <button class="btn-close" (click)="closeCreateModal()">
        <span class="material-icons">close</span>
      </button>
    </div>

    <form (ngSubmit)="createFormation()" class="modal-body">
      <div class="form-group">
        <label>Titre *</label>
        <input 
          type="text" 
          [(ngModel)]="newFormation.title" 
          name="title"
          placeholder="Ex: Formation JavaScript Avancé"
          required>
      </div>

      <div class="form-group">
        <label>Description</label>
        <textarea 
          [(ngModel)]="newFormation.description" 
          name="description"
          rows="4"
          placeholder="Décrivez votre formation..."></textarea>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Niveau</label>
          <select [(ngModel)]="newFormation.level" name="level">
            <option value="DEBUTANT">Débutant</option>
            <option value="INTERMEDIAIRE">Intermédiaire</option>
            <option value="AVANCE">Avancé</option>
          </select>
        </div>

        <div class="form-group">
          <label>Catégorie</label>
          <input 
            type="text" 
            [(ngModel)]="newFormation.category" 
            name="category"
            placeholder="Ex: Programmation">
        </div>
      </div>

      <div class="form-group">
        <label>Durée (en heures)</label>
        <input 
          type="number" 
          [(ngModel)]="newFormation.duration" 
          name="duration"
          min="0"
          step="0.5">
      </div>

      <div class="form-group">
        <label>URL de l'image (optionnel)</label>
        <input 
          type="url" 
          [(ngModel)]="newFormation.thumbnail" 
          name="thumbnail"
          placeholder="https://...">
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeCreateModal()">
          Annuler
        </button>
        <button type="submit" class="btn btn-primary" [disabled]="isCreating || !newFormation.title.trim()">
          <span *ngIf="isCreating" class="spinner-small"></span>
          <span *ngIf="!isCreating">Créer la Formation</span>
          <span *ngIf="isCreating">Création...</span>
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Modal d'Édition de Formation -->
<div *ngIf="showEditModal && editingFormation" class="modal-overlay" (click)="closeEditModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Modifier la Formation</h2>
      <button class="btn-close" (click)="closeEditModal()">
        <span class="material-icons">close</span>
      </button>
    </div>

    <form (ngSubmit)="updateFormation()" class="modal-body">
      <div class="form-group">
        <label>Titre *</label>
        <input 
          type="text" 
          [(ngModel)]="editFormation.title" 
          name="editTitle"
          placeholder="Ex: Formation JavaScript Avancé"
          required>
      </div>

      <div class="form-group">
        <label>Description</label>
        <textarea 
          [(ngModel)]="editFormation.description" 
          name="editDescription"
          rows="4"
          placeholder="Décrivez votre formation..."></textarea>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Niveau</label>
          <select [(ngModel)]="editFormation.level" name="editLevel">
            <option value="DEBUTANT">Débutant</option>
            <option value="INTERMEDIAIRE">Intermédiaire</option>
            <option value="AVANCE">Avancé</option>
          </select>
        </div>

        <div class="form-group">
          <label>Catégorie</label>
          <input 
            type="text" 
            [(ngModel)]="editFormation.category" 
            name="editCategory"
            placeholder="Ex: Programmation">
        </div>
      </div>

      <div class="form-group">
        <label>Durée (en heures)</label>
        <input 
          type="number" 
          [(ngModel)]="editFormation.duration" 
          name="editDuration"
          min="0"
          step="0.5">
      </div>

      <div class="form-group">
        <label>URL de l'image (optionnel)</label>
        <input 
          type="url" 
          [(ngModel)]="editFormation.thumbnail" 
          name="editThumbnail"
          placeholder="https://...">
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeEditModal()">
          Annuler
        </button>
        <button type="submit" class="btn btn-primary" [disabled]="isUpdating || !editFormation.title.trim()">
          <span *ngIf="isUpdating" class="spinner-small"></span>
          <span *ngIf="!isUpdating">Enregistrer les modifications</span>
          <span *ngIf="isUpdating">Enregistrement...</span>
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Modal de Création depuis Template -->
<div *ngIf="showTemplateModal" class="modal-overlay" (click)="closeTemplateModal()">
  <div class="modal-content template-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Créer une Formation depuis un Template</h2>
      <button class="btn-close" (click)="closeTemplateModal()">
        <span class="material-icons">close</span>
      </button>
    </div>

    <div class="modal-body">
      <p class="template-description">
        Sélectionnez un template pour créer automatiquement une formation complète avec :
      </p>
      <ul class="template-features">
        <li><span class="material-icons">check_circle</span> Modules structurés</li>
        <li><span class="material-icons">check_circle</span> Cours avec leçons (vidéo, texte, schéma)</li>
        <li><span class="material-icons">check_circle</span> Quiz d'évaluation par module</li>
        <li><span class="material-icons">check_circle</span> Contenu logique et progressif</li>
      </ul>

      <div class="template-list">
        <div 
          class="template-card" 
          [class.selected]="selectedTemplate === 'javascript'"
          (click)="selectedTemplate = 'javascript'">
          <div class="template-icon">
            <span class="material-icons">code</span>
          </div>
          <div class="template-info">
            <h3>Formation JavaScript Complète</h3>
            <p>Une formation complète pour maîtriser JavaScript de A à Z</p>
            <div class="template-stats">
              <span><span class="material-icons">menu_book</span> 4 modules</span>
              <span><span class="material-icons">play_circle</span> 12 cours</span>
              <span><span class="material-icons">schedule</span> 40 heures</span>
            </div>
          </div>
          <div class="template-check">
            <span class="material-icons" *ngIf="selectedTemplate === 'javascript'">check_circle</span>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeTemplateModal()">
          Annuler
        </button>
        <button 
          type="button" 
          class="btn btn-primary" 
          [disabled]="isCreatingFromTemplate || !selectedTemplate"
          (click)="createFormationFromTemplate(selectedTemplate!)">
          <span *ngIf="isCreatingFromTemplate" class="spinner-small"></span>
          <span *ngIf="!isCreatingFromTemplate">Créer la Formation</span>
          <span *ngIf="isCreatingFromTemplate">Création en cours...</span>
        </button>
      </div>
    </div>
  </div>
</div>
